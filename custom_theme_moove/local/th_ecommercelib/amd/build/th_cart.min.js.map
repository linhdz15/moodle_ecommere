{"version":3,"file":"th_cart.min.js","sources":["../src/th_cart.js"],"sourcesContent":["import $ from 'jquery';\nimport mdlcfg from 'core/config';\nimport ls from 'local_th_ecommercelib/localstorage-slim';\nimport {exception as displayException} from 'core/notification';\n\nexport const ttl = 50000;\nexport const cart_count_selector = '.th_lblCartCount';\nconst key_cart = 'th_cart';\n\nexport const ajax_check_payment_methods = ()=>{\n\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            url: `${mdlcfg.wwwroot}/local/th_edumy_cart/ajax_update_cart.php`,\n            method: \"POST\",\n            dataType: 'json',\n            data: {\n                function: \"check_method\",\n            },\n\n            success:function(response){\n                resolve(response);\n            },\n\n            error: function (xhr, ajaxOptions, thrownError) {\n                reject(xhr,ajaxOptions,thrownError)\n            }\n        });\n    });\n}\n\nexport const ajax_checkprice = ($request_param)=>{\n\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            url: `${mdlcfg.wwwroot}/local/th_edumy_cart/ajax_update_cart.php`,\n            method: \"POST\",\n            dataType: 'json',\n            data: {\n                function: \"checkprice\",\n                request_param:$request_param\n            },\n\n            success:function(response){\n                resolve(response);\n            },\n\n            error: function (xhr, ajaxOptions, thrownError) {\n                reject(xhr,ajaxOptions,thrownError)\n            }\n        });\n    });\n}\n\n\nexport const ajax_add_to_cart = ($courseid)=>{\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            url: `${mdlcfg.wwwroot}/local/th_edumy_cart/ajax_update_cart.php`,\n            method: \"POST\",\n            dataType: 'json',\n            data: {\n                function: \"add_to_cart\",\n                courseid: $courseid\n            },\n\n            success:function(response){\n                resolve(response);\n            },\n\n            error: function (xhr, ajaxOptions, thrownError) {\n                reject(xhr,ajaxOptions,thrownError)\n            }\n        });\n    });\n}\n\n\nexport const ajax_get_card_number = ()=>{\n\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            url: `${mdlcfg.wwwroot}/local/th_edumy_cart/ajax_update_cart.php`,\n            method: \"POST\",\n            dataType: 'json',\n            data: {\n                function: \"get_card_number\",\n            },\n\n            success:function(response){\n                resolve(response);\n            },\n\n            error: function (xhr, ajaxOptions, thrownError) {\n                reject(xhr,ajaxOptions,thrownError)\n            }\n        });\n    });\n}\n\n\nexport const update_cart_number = (number_product=null)=>{\n    if(number_product){\n        $(cart_count_selector).text(number_product);\n    }\n    else{\n        ajax_get_card_number().then((response)=>{\n            if(response.isloggedin){\n                $(cart_count_selector).text(response.num_product)\n            }\n            else\n            {\n                ls_cart = ls.get(key_cart,{ decrypt: true });\n                if(ls_cart){\n                    newcart = new Cart();\n                    Object.assign(newcart,ls_cart);\n                    num_product = ls_cart.products.length;\n                    $(cart_count_selector).text(num_product);\n                }\n                else\n                {\n                    $(cart_count_selector).text(0);\n                }\n            }\n        })\n    }\n}\n\n\n\nexport const add_to_cart = (selector)=>{\n    $(document).ready(function(){\n\n        $(document).on(\"click\",selector,()=>{\n            $btn_muangay = $(selector);\n            $courseid = $btn_muangay.attr('data-courseid');\n            ajax_add_to_cart($courseid).then((response)=>{\n                \n                if(response.isloggedin){\n                    if(response.duplicate){\n                        showCustomToast(\"Sản phẩm đã có trong giỏ hàng!\");\n                        \n                    } else {\n                        showCustomToast(\"Sản phẩm đã được thêm vào giỏ hàng!\");\n                    }\n                    num_product = response.num_product;\n                    update_cart_number(num_product);\n                }\n                else\n                {\n                    product = response.product;\n                    newcart = new Cart();\n\n                    ls_cart = ls.get(key_cart,{ decrypt: true });\n                    if(ls_cart){\n                        Object.assign(newcart,ls_cart);\n                    }\n                    var existingProduct = newcart.products.find(function(item) {\n                        return item.id === product.id;\n                    });\n\n                    if (existingProduct) {\n                        showCustomToast(\"Sản phẩm đã có trong giỏ hàng!\");\n                    } else {\n                        showCustomToast(\"Sản phẩm đã được thêm vào giỏ hàng!\");\n                        newcart.add_product(product);\n                        ls.set(key_cart, newcart, { ttl: ttl, encrypt: true });\n                    }\n\n                    num_product = newcart.products.length;\n                    update_cart_number(num_product);\n                }\n            })/*.catch((xhr, ajaxOptions, thrownError)=>{\n              \n              \n              \n            })*/\n            })\n\n    });\n};\n\nexport const showError = (errormessage)=>\n{\n    displayException(new Error(errormessage));\n}\n\nexport const showCustomToast = (message)=>{\n    require(['core/toast'], Toast => {\n        Toast.add(message,{\n            closeButton: true,\n        });\n    })\n};"],"names":["Promise","resolve","reject","ajax","url","mdlcfg","wwwroot","method","dataType","data","function","success","response","error","xhr","ajaxOptions","thrownError","$request_param","request_param","ajax_add_to_cart","$courseid","courseid","ajax_get_card_number","update_cart_number","number_product","text","then","isloggedin","num_product","ls_cart","ls","get","decrypt","newcart","Cart","Object","assign","products","length","selector","document","ready","on","$btn_muangay","attr","duplicate","showCustomToast","product","find","item","id","add_product","set","ttl","encrypt","errormessage","Error","message","require","Toast","add","closeButton"],"mappings":"kvBAKmB,iCACgB,uDAGO,kBAE/B,IAAIA,SAAQ,SAACC,QAASC,wBACvBC,KAAK,CACHC,cAAQC,gBAAOC,qDACfC,OAAQ,OACRC,SAAU,OACVC,KAAM,CACFC,SAAU,gBAGdC,QAAQ,SAASC,UACbX,QAAQW,WAGZC,MAAO,SAAUC,IAAKC,YAAaC,aAC/Bd,OAAOY,IAAIC,YAAYC,6CAMR,SAACC,uBAErB,IAAIjB,SAAQ,SAACC,QAASC,wBACvBC,KAAK,CACHC,cAAQC,gBAAOC,qDACfC,OAAQ,OACRC,SAAU,OACVC,KAAM,CACFC,SAAU,aACVQ,cAAcD,gBAGlBN,QAAQ,SAASC,UACbX,QAAQW,WAGZC,MAAO,SAAUC,IAAKC,YAAaC,aAC/Bd,OAAOY,IAAIC,YAAYC,wBAO1BG,iBAAmB,SAACC,kBACtB,IAAIpB,SAAQ,SAACC,QAASC,wBACvBC,KAAK,CACHC,cAAQC,gBAAOC,qDACfC,OAAQ,OACRC,SAAU,OACVC,KAAM,CACFC,SAAU,cACVW,SAAUD,WAGdT,QAAQ,SAASC,UACbX,QAAQW,WAGZC,MAAO,SAAUC,IAAKC,YAAaC,aAC/Bd,OAAOY,IAAIC,YAAYC,mEAO1BM,qBAAuB,kBAEzB,IAAItB,SAAQ,SAACC,QAASC,wBACvBC,KAAK,CACHC,cAAQC,gBAAOC,qDACfC,OAAQ,OACRC,SAAU,OACVC,KAAM,CACFC,SAAU,mBAGdC,QAAQ,SAASC,UACbX,QAAQW,WAGZC,MAAO,SAAUC,IAAKC,YAAaC,aAC/Bd,OAAOY,IAAIC,YAAYC,2EAO1BO,mBAAqB,eAACC,sEAAe,KAC3CA,mCAhG4B,oBAiGJC,KAAKD,gBAG5BF,uBAAuBI,MAAK,SAACd,UACtBA,SAASe,+BArGW,oBAsGIF,KAAKb,SAASgB,cAIrCC,QAAUC,0BAAGC,IAzGZ,UAyGyB,CAAEC,SAAS,IAClCH,SACCI,QAAU,IAAIC,KACdC,OAAOC,OAAOH,QAAQJ,SACtBD,YAAcC,QAAQQ,SAASC,2BA9GhB,oBA+GQb,KAAKG,kCA/Gb,oBAmHQH,KAAK,4EASrB,SAACc,8BACtBC,UAAUC,OAAM,+BAEZD,UAAUE,GAAG,QAAQH,UAAS,WAC5BI,cAAe,mBAAEJ,UACjBnB,UAAYuB,aAAaC,KAAK,iBAC9BzB,iBAAiBC,WAAWM,MAAK,SAACd,UAE3BA,SAASe,YACLf,SAASiC,UACRC,gBAAgB,kCAGhBA,gBAAgB,uCAEpBlB,YAAchB,SAASgB,YACvBL,mBAAmBK,eAInBmB,QAAUnC,SAASmC,QACnBd,QAAU,IAAIC,KAEdL,QAAUC,0BAAGC,IAlJhB,UAkJ6B,CAAEC,SAAS,IAClCH,SACCM,OAAOC,OAAOH,QAAQJ,SAEJI,QAAQI,SAASW,MAAK,SAASC,aAC1CA,KAAKC,KAAOH,QAAQG,MAI3BJ,gBAAgB,mCAEhBA,gBAAgB,uCAChBb,QAAQkB,YAAYJ,mCACjBK,IA/JV,UA+JwBnB,QAAS,CAAEoB,IAjKjC,IAiK2CC,SAAS,KAGnD1B,YAAcK,QAAQI,SAASC,OAC/Bf,mBAAmBK,2CAYd,SAAC2B,0CAEL,IAAIC,MAAMD,oBAGlBT,gBAAkB,SAACW,SAC5BC,QAAQ,CAAC,eAAe,SAAAC,OACpBA,MAAMC,IAAIH,QAAQ,CACdI,aAAa"}