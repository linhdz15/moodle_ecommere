define("local_th_ecommercelib/th_cart",["exports","jquery","core/config","local_th_ecommercelib/localstorage-slim","core/notification"],(function(_exports,_jquery,_config,_localstorageSlim,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.update_cart_number=_exports.ttl=_exports.showError=_exports.showCustomToast=_exports.cart_count_selector=_exports.ajax_get_card_number=_exports.ajax_checkprice=_exports.ajax_check_payment_methods=_exports.ajax_add_to_cart=_exports.add_to_cart=void 0,_jquery=_interopRequireDefault(_jquery),_config=_interopRequireDefault(_config),_localstorageSlim=_interopRequireDefault(_localstorageSlim);_exports.ttl=5e4;_exports.cart_count_selector=".th_lblCartCount";_exports.ajax_check_payment_methods=function(){return new Promise((function(resolve,reject){_jquery.default.ajax({url:"".concat(_config.default.wwwroot,"/local/th_edumy_cart/ajax_update_cart.php"),method:"POST",dataType:"json",data:{function:"check_method"},success:function(response){resolve(response)},error:function(xhr,ajaxOptions,thrownError){reject(xhr,ajaxOptions,thrownError)}})}))};_exports.ajax_checkprice=function($request_param){return new Promise((function(resolve,reject){_jquery.default.ajax({url:"".concat(_config.default.wwwroot,"/local/th_edumy_cart/ajax_update_cart.php"),method:"POST",dataType:"json",data:{function:"checkprice",request_param:$request_param},success:function(response){resolve(response)},error:function(xhr,ajaxOptions,thrownError){reject(xhr,ajaxOptions,thrownError)}})}))};var ajax_add_to_cart=function($courseid){return new Promise((function(resolve,reject){_jquery.default.ajax({url:"".concat(_config.default.wwwroot,"/local/th_edumy_cart/ajax_update_cart.php"),method:"POST",dataType:"json",data:{function:"add_to_cart",courseid:$courseid},success:function(response){resolve(response)},error:function(xhr,ajaxOptions,thrownError){reject(xhr,ajaxOptions,thrownError)}})}))};_exports.ajax_add_to_cart=ajax_add_to_cart;var ajax_get_card_number=function(){return new Promise((function(resolve,reject){_jquery.default.ajax({url:"".concat(_config.default.wwwroot,"/local/th_edumy_cart/ajax_update_cart.php"),method:"POST",dataType:"json",data:{function:"get_card_number"},success:function(response){resolve(response)},error:function(xhr,ajaxOptions,thrownError){reject(xhr,ajaxOptions,thrownError)}})}))};_exports.ajax_get_card_number=ajax_get_card_number;var update_cart_number=function(){var number_product=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;number_product?(0,_jquery.default)(".th_lblCartCount").text(number_product):ajax_get_card_number().then((function(response){response.isloggedin?(0,_jquery.default)(".th_lblCartCount").text(response.num_product):(ls_cart=_localstorageSlim.default.get("th_cart",{decrypt:!0}),ls_cart?(newcart=new Cart,Object.assign(newcart,ls_cart),num_product=ls_cart.products.length,(0,_jquery.default)(".th_lblCartCount").text(num_product)):(0,_jquery.default)(".th_lblCartCount").text(0))}))};_exports.update_cart_number=update_cart_number;_exports.add_to_cart=function(selector){(0,_jquery.default)(document).ready((function(){(0,_jquery.default)(document).on("click",selector,(function(){$btn_muangay=(0,_jquery.default)(selector),$courseid=$btn_muangay.attr("data-courseid"),ajax_add_to_cart($courseid).then((function(response){response.isloggedin?(response.duplicate?showCustomToast("Sản phẩm đã có trong giỏ hàng!"):showCustomToast("Sản phẩm đã được thêm vào giỏ hàng!"),num_product=response.num_product,update_cart_number(num_product)):(product=response.product,newcart=new Cart,ls_cart=_localstorageSlim.default.get("th_cart",{decrypt:!0}),ls_cart&&Object.assign(newcart,ls_cart),newcart.products.find((function(item){return item.id===product.id}))?showCustomToast("Sản phẩm đã có trong giỏ hàng!"):(showCustomToast("Sản phẩm đã được thêm vào giỏ hàng!"),newcart.add_product(product),_localstorageSlim.default.set("th_cart",newcart,{ttl:5e4,encrypt:!0})),num_product=newcart.products.length,update_cart_number(num_product))}))}))}))};_exports.showError=function(errormessage){(0,_notification.exception)(new Error(errormessage))};var showCustomToast=function(message){require(["core/toast"],(function(Toast){Toast.add(message,{closeButton:!0})}))};_exports.showCustomToast=showCustomToast}));

//# sourceMappingURL=th_cart.min.js.map